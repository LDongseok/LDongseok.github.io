<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Domain Creator</title>
  
  <!-- Plotly.js for 2D plotting -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  
  <!-- MathJax (optional for LaTeX rendering) -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script 
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: black;
      color: lightblue;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .container {
      width: 80%;
      margin: auto;
      padding: 20px;
    }
    h1 {
      margin: 20px 0;
    }
    .description {
      font-size: 1.1em;
      margin-bottom: 20px;
      color: lightblue;
      background-color: #333;
      padding: 10px;
      border-radius: 5px;
      text-align: left;
      display: inline-block;
    }
    #clickPlot {
      width: 600px;
      height: 400px;
      margin: auto;
      background-color: #222;
    }
    button {
      background: red;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1.2em;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Domain Creator</h1>
    
    <div class="description">
      <p>
        Click exactly 4 points on the 2D plot to define a domain. The domain is interpreted as the rectangle defined by 
        \(\( x_{\min}, x_{\max}, y_{\min}, y_{\max} \)\). Once 4 points are selected, a red translucent rectangle will be drawn.
      </p>
    </div>
    
    <!-- 2D click plot for picking domain corners -->
    <div id="clickPlot"></div>
    <button onclick="clearDomain()">Clear Domain</button>
  </div>
  
  <script>
    // Array to store the 4 corner points
    let domainPoints = [];
    
    // Initial 2D scatter plot layout with empty shapes array
    let layout2D = {
      title: "Click 4 Points for Domain Corners",
      xaxis: { range: [0, 1], title: "x" },
      yaxis: { range: [0, 1], title: "y" },
      shapes: []
    };
    
    Plotly.newPlot("clickPlot", [{
      x: [], 
      y: [], 
      mode: 'markers',
      marker: { color: 'cyan' }
    }], layout2D);
    
    // Listen for click events on the plot
    document.getElementById("clickPlot").on("plotly_click", (data) => {
      if (domainPoints.length >= 4) {
        alert("You have already selected 4 points. Click 'Clear Domain' to start over.");
        return;
      }
      
      let xVal = data.points[0].x;
      let yVal = data.points[0].y;
      domainPoints.push([xVal, yVal]);
      console.log("Clicked:", xVal, yVal);
      
      // Update the scatter trace with the new point
      let update = {
        x: [[xVal]],
        y: [[yVal]]
      };
      Plotly.extendTraces("clickPlot", update, [0]);
      
      // Once 4 points are selected, draw the domain rectangle
      if (domainPoints.length === 4) {
        let xs = domainPoints.map(p => p[0]);
        let ys = domainPoints.map(p => p[1]);
        let xmin = Math.min(...xs);
        let xmax = Math.max(...xs);
        let ymin = Math.min(...ys);
        let ymax = Math.max(...ys);
        
        let rectShape = {
          type: 'rect',
          xref: 'x',
          yref: 'y',
          x0: xmin,
          x1: xmax,
          y0: ymin,
          y1: ymax,
          fillcolor: 'rgba(255,0,0,0.2)',
          line: { color: 'red' }
        };
        
        // Update the layout to include the rectangle shape
        layout2D.shapes.push(rectShape);
        Plotly.relayout("clickPlot", { shapes: layout2D.shapes });
      }
    });
    
    // Function to clear the domain and reset the plot
    function clearDomain() {
      domainPoints = [];
      layout2D.shapes = [];
      Plotly.newPlot("clickPlot", [{
        x: [],
        y: [],
        mode: 'markers',
        marker: { color: 'cyan' }
      }], layout2D);
    }
  </script>
</body>
</html>

